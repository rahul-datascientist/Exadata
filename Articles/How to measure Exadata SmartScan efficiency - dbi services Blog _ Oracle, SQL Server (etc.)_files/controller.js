(function(){var e=function(e){var t=this;e.require().script("mvc/class","mvc/lang.string","mvc/event.destroyed").done(function(){var n=function(){var t=function(t,n,r){var s,o=t.bind&&t.unbind?t:e(i(t)?[t]:t);return n.indexOf(">")===0&&(n=n.substr(1),s=function(e){e.target===t&&r.apply(this,arguments)}),o.bind(n,s||r),function(){o.unbind(n,s||r),t=n=r=s=null}},n=e.makeArray,r=e.isArray,i=e.isFunction,s=e.extend,o=e.String,u=e.each,a="prototype",f="constructor",l=Array[a].slice,c=function(t,n,r,s){n.indexOf(">")===0&&(n=(t.data("directSelector")+" "||"")+n);var o=t.delegate&&t.undelegate?t:e(i(t)?[t]:t);return o.delegate(n,r,s),function(){o.undelegate(n,r,s),o=t=r=s=n=null}},h=function(e,n,r,i){return i?c(e,i,n,r):t(e,n,r)},p=function(n,r){var i=typeof r=="string"?n[r]:r;return function(){return n.called=r,i.apply(n,[this.nodeName?e(this):this].concat(l.call(arguments,0)))}},d=/\./g,v=/_?controllers?/ig,m=function(t){return o.underscore(t.replace(e.globalNamespace+".","").replace(d,"_").replace(v,""))},g=/^\S(.*)\s(.*)/,y=/\{([^\}]+)\}/g,b=/^(?:(.*?)\s)?([\w\.\:>]+)$/,w,E=function(t,n){return e.data(t,"controllers",n)};e.Class(e.globalNamespace+".Controller",{setup:function(){this._super.apply(this,arguments);if(!this.shortName||this.fullName==e.globalNamespace+".Controller")return;this._fullName=m(this.fullName),this._shortName=m(this.shortName);var t=arguments[3],r;i(t)&&(this.protoFactory=t,r=this.protoFactory.call(this,null));var s=this,o,u;if(this.isPlugin){var f=this.pluginName||this._fullName;e.fn[f]||(e.fn[f]=function(e){var t=n(arguments),r=typeof e=="string"&&i(s[a][e]),o=t[0];return this.each(function(){var e=E(this),n=e&&e[f];n?r?n[o].apply(n,t.slice(1)):n.update.apply(n,t):s.newInstance.apply(s,[this].concat(t))})})}this.actions={},r=r||this[a];for(o in r){if(o=="constructor"||!i(r[o]))continue;this._isAction(o)&&(this.actions[o]=this._action(o))}},hookup:function(e){return new this(e)},_isAction:function(t){return g.test(t)?!0:e.inArray(t,this.listensTo)>-1||e.event.special[t]||S[t]},_action:function(t,n){y.lastIndex=0;if(!n&&y.test(t))return null;var i=[],s,u;return t.match(/^\[.+\]/)?(methodNames=t.replace(/^\[|\]/g,"").replace(", ",",").split(" "),s=methodNames.pop(),methodNames=methodNames[0].split(",")):methodNames=[t],e.each(methodNames,function(e,t){t=t.replace("{self} ","");var u=n?o.sub(t,[n,window]):t,a=r(u),f=s?[u+" "+s,u,s]:(a?u[1]:u).match(b),l=s||f[2],c=S[l]||w;i.push({processor:c,parts:f,delegate:a?u[0]:undefined})}),i},processors:{},listensTo:[],defaults:{}},{setup:function(t,r){var i,o,u=this[f];if(u.protoFactory){var a=u.protoFactory.call(u,this);e.extend(!0,this,a)}this.bind=this._bind,t=(typeof t=="string"?e(t):t.jquery?t:[t])[0];var l=u.pluginName||u._fullName;this.element=e(t),(E(t)||E(t,{}))[l]=this,this.instanceId=e.uid(u._fullName+"_");if(this.element.data("directSelector")===undefined){var c=e.uid("DS");this.element.data("directSelector","."+c),this.element.addClass(c)}this.options=s(!0,{},u.defaults,u.defaultOptions,r);for(prop in this.options)if(prop.match(/^\{.+\}$/)){var c=this.options[prop],h=prop.replace(/^\{|\}$/g,"");this[h]=function(e,t,n){if(typeof t!="string")return t;t=/^(\.|\#)$/.test(t)?t+n:t;var r=function(n){return n?e.element.find(t).filter(n):e.element.find(t)};return r.selector=t,r}(this,c,h)}var p=this,d=this.options.view,v=p.view;return p.view=function(){return v.apply(this,arguments)},e.isPlainObject(d)&&e.each(d,function(t){p.view[t]=function(){var n=e.makeArray(arguments),r=!1;typeof n[0]=="boolean"&&(r=n[0],n=n.slice(1));var i=[r,t].concat(n);return p.view.apply(p,i)}}),e.extend(this,this.options.controller),this.called="init",this.bind(),[this.element,this.options].concat(n(arguments).slice(2))},_bind:function(t,n,r){if(t===undefined){this._bindings=[];var i=this[f],s=this._bindings,o=i.actions,u=this.element;for(funcName in o)if(o.hasOwnProperty(funcName)){readyList=i.actions[funcName]||i._action(funcName,this.options);var a=this;e.each(readyList,function(e,t){a._bindings.push(t.processor(t.delegate||u,t.parts[2],t.parts[1],funcName,a))})}var l=p(this,"destroy");return u.bind("destroyed",l),s.push(function(t){e(t).unbind("destroyed",l)}),s.length}return typeof t=="string"&&(r=n,n=t,t=this.element),this._binder(t,n,r)},_binder:function(e,t,n,r){return typeof n=="string"&&(n=p(this,n)),this._bindings.push(h(e,t,n,r)),this._bindings.length},_unbind:function(){var e=this.element[0];u(this._bindings,function(t,n){n(e)}),this._bindings=[]},trigger:function(){this.element.trigger.apply(this.element,arguments)},delegate:function(e,t,n,r){return typeof e=="string"&&(r=n,n=t,t=e,e=this.element),this._binder(e,n,r,t)},update:function(e){s(this.options,e),this._unbind(),this.bind()},destroy:function(){if(this._destroyed){try{console.error(this[f].shortName+" controller already deleted")}catch(t){}return}var n=this,r=this[f].pluginName||this[f]._fullName,i;this._destroyed=!0,this.element.removeClass(r),this._unbind(),delete this._actions,delete this.element.data("controllers")[r],e(this).triggerHandler("destroyed"),this.element=null},find:function(e){return this.element.find(e)},view:function(){var t=e.makeArray(arguments),n,r=t,i=!1,s=this[f].component||e,o="",u=this.options.view||{};return typeof t[0]=="boolean"&&(i=t[0],r=t.slice(1)),n=r[0]=u[r[0]],n==undefined?i?"":e(""):(o=s.View.apply(s,r),i?o:e(o))},_set_called:!0});var S=e.Controller.processors,w=function(e,t,n,r,i){return h(e,t,p(i,r),n)};u("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset resize scroll select submit focusin focusout mouseenter mouseleave".split(" "),function(e,t){S[t]=w});var x,T=function(e,t){for(x=0;x<t.length;x++)if(typeof t[x]=="string"?e[f]._shortName==t[x]:e instanceof t[x])return!0;return!1};e.fn.extend({controllers:function(){var t=n(arguments),r=[],i,s,o;return this.each(function(){i=e.data(this,"controllers");for(o in i)i.hasOwnProperty(o)&&(s=i[o],(!t.length||T(s,t))&&r.push(s))}),r},controller:function(e){return this.controllers.apply(this,arguments)[0]},implement:function(t,n,r){var i=this,s;return typeof t=="string"&&(s=t,t=e.String.getObject(s)),t!==undefined&&e.each(i,function(){var e=new t(this,n);r&&r.apply(e)}),this}})};n(),t.resolveWith(n)})};dispatch("mvc/controller").containing(e).to("Foundry/2.1 Modules")})();